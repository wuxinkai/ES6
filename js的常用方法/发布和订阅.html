<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

</body>

</html>
<script>
    /*
    * 发布订阅模式(观察者模式)
    * on: 订阅事件
    * emit: 发布事件
    * off: 删除事件

    */

    // 工厂
    class Pubsub {
        //原型
        constructor() {
            this.handles = {}
        }
        //订阅事件
        on(eventType, handle) {
            if (!this.handles.hasOwnProperty(eventType)) { //判断对象中有没有这个属性，有就不在追加
                this.handles[eventType] = []
            }
            if (typeof handle == 'function') {
                this.handles[eventType].push(handle);
            } else {
                throw new Error('缺少回调函数');
            }
            return this
        }
        //发布事件
        emit(eventType, ...args) {
            if (this.handles.hasOwnProperty(eventType)) { //判断事件是否注册
                this.handles[eventType].forEach((item, key, arr) => {
                    // item.call(null, args);
                    item.apply(null, args);
                })
            } else {
                throw new Error(`"${eventType}"事件未注册`);
            }
            return this
        }
        //删除 事件
        off(eventType, handle) {
            if (!this.handles.hasOwnProperty(eventType)) {
                throw new Error(`"${eventType}"事件未注册`);
            } else if (typeof handle != 'function') {
                throw new Error('缺少回调函数');
            } else {
                this.handles[eventType].forEach((item, key, arr) => {
                    if (item == handle) {
                        arr.splice(key, 1); //call和apply都是在回调函数的时候应用
                    }
                })
            }
            return this
        }
    }

    //进来参观的人
    let p = new Pubsub()

    //先有订阅者
    p.on('jianb_ting1', (...args) => {
        console.log(1, args.join(''));
    }).on('jianb_ting1', (...args) => {
        console.log('回调函数1');
    })
    p.on('jianb_ting1', (...args) => {
        console.log(2, args.join(''));
    }).on('jianb_ting1', (...args) => {
        console.log('回调函数2');
    })


    //订阅者
    p.on('jianb_ting2', (...args) => {
        console.log(1, args.join(''));
    })
    p.on('jianb_ting2', (...args) => {
        console.log(1, args.join(''));
    })
    p.on('jianb_ting2', (...args) => {
        console.log(1, args.join(''));
    })

    //发射一个事件
    p.emit('jianb_ting1', '可以', '传多个', '参数', '通过...arr', '转为', '数组');

    console.log(`------------------------------------------------`);
    p.emit('jianb_ting2', '传不同的', '的内容');
</script>